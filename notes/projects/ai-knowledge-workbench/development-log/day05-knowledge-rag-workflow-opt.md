---
title: Day 05 - Knowledge RAG Workflow Optimization
description: Building the Minimal RAG Closed Loop â€”â€” An End-to-End Experience Optimization from Knowledge Base Construction to AI Conversation.
date: 2026-01-23
category: projects
project: ai-knowledge-workbench

---

# Day 05 - æ‰“é€  RAG æœ€å°é—­ç¯ï¼šä»çŸ¥è¯†åº“æ„å»ºåˆ°å¯¹è¯çš„ä¸€ç«™å¼ä½“éªŒä¼˜åŒ–

> **é¡¹ç›®èƒŒæ™¯**ï¼šåŸºäº Vue3 + MCP çš„ AI çŸ¥è¯†å·¥ä½œå°ï¼Œæ—¨åœ¨æä¾›ä¸ªäººåŒ–çš„ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰å®éªŒç¯å¢ƒã€‚
> **ä»Šæ—¥èšç„¦**ï¼šä¼˜åŒ– Knowledge æ¨¡å—çš„ç”¨æˆ·ä½“éªŒï¼Œæ‰“é€š"çŸ¥è¯†ç”Ÿäº§"åˆ°"çŸ¥è¯†æ¶ˆè´¹"çš„æ•°æ®é“¾è·¯ã€‚

## ğŸ’¡ æ ¸å¿ƒæ€è€ƒ

åœ¨ RAG ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·çš„ä½¿ç”¨è·¯å¾„é€šå¸¸æ˜¯ï¼š`ä¸Šä¼ èµ„æ–™ -> ç­‰å¾…å‘é‡åŒ– -> å¼€å§‹å¯¹è¯`ã€‚
åœ¨æ—©æœŸçš„ MVP ç‰ˆæœ¬ä¸­ï¼ŒChat å’Œ Knowledge æ˜¯å‰²è£‚çš„ä¸¤ä¸ªé¡µé¢ã€‚ç”¨æˆ·åœ¨ Knowledge é¡µä¸Šä¼ å®Œï¼Œéœ€è¦æ‰‹åŠ¨åˆ‡åˆ° Chat é¡µå»æ‰¾åˆšæ‰çš„æ–‡ä»¶ï¼Œä¸”æ²¡æœ‰ç›´è§‚çš„çŠ¶æ€åé¦ˆã€‚

ä¸ºäº†æå‡**å·¥ç¨‹å¯ç”¨æ€§**å’Œ**ç”¨æˆ·å¿ƒæµï¼ˆFlowï¼‰**ï¼Œä»Šå¤©æˆ‘é‡ç‚¹è§£å†³äº†ä¸‰ä¸ªé—®é¢˜ï¼š
1.  **å†·å¯åŠ¨ä½“éªŒ**ï¼šç”¨æˆ·ç¬¬ä¸€æ¬¡è¿›æ¥ä¸çŸ¥é“å¹²ä»€ä¹ˆã€‚
2.  **çŠ¶æ€å¯è§†æ€§**ï¼šç”¨æˆ·ä¸çŸ¥é“çŸ¥è¯†åº“ä»€ä¹ˆæ—¶å€™"Ready"ã€‚
3.  **ä¸šåŠ¡é—­ç¯**ï¼šå¦‚ä½•è®©ç”¨æˆ·åˆšå»ºå¥½çš„çŸ¥è¯†åº“èƒ½"ç§’ç”¨"ã€‚

---

## ğŸš€ å…³é”®æ”¹åŠ¨ä¸æŠ€æœ¯å®ç°

### 1. å®Œå–„ç©ºçŠ¶æ€ (Empty State) ä¸å¼•å¯¼
*è§£å†³ç—›ç‚¹ï¼šåˆæ¬¡è¿›å…¥é¡µé¢æ—¶çš„è¿·èŒ«æ„Ÿã€‚*

æˆ‘æ²¡æœ‰ç®€å•åœ°å†™ä¸€ä¸ª "No Data"ï¼Œè€Œæ˜¯å°†ç©ºçŠ¶æ€è®¾è®¡ä¸º**åŠŸèƒ½å¼•å¯¼åŒº**ã€‚
- **UI è®¾è®¡**ï¼šä½¿ç”¨è™šçº¿æ¡† + æ¸…æ™°çš„ CTA (Call To Action) æŒ‰é’®ã€‚
- **æ–‡æ¡ˆä¼˜åŒ–**ï¼šæ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·ä¸Šä¼ åçš„é¢„æœŸè¡Œä¸ºï¼ˆå¦‚ï¼š"ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç† processing -> ready"ï¼‰ï¼Œé™ä½è®¤çŸ¥è´Ÿè·ã€‚
- **äº¤äº’é€»è¾‘**ï¼šç‚¹å‡»å¼•å¯¼æŒ‰é’®åï¼Œè‡ªåŠ¨èšç„¦åˆ°ç¼–è¾‘å™¨çš„è¾“å…¥æ¡†ï¼Œå‡å°‘ä¸€æ­¥ç‚¹å‡»æ“ä½œã€‚

### 2. è¡Œå†…çŠ¶æ€æœºå¯è§†åŒ– (Status Badge)
*è§£å†³ç—›ç‚¹ï¼šå¼‚æ­¥å¤„ç†è¿‡ç¨‹ä¸­çš„çŠ¶æ€é»‘ç›’ã€‚*

ç”±äº RAG å‘é‡åŒ–æ˜¯ä¸€ä¸ªè€—æ—¶è¿‡ç¨‹ï¼Œæˆ‘å¼•å…¥äº†è¡Œå†…çŠ¶æ€ Badgeï¼š
- **Processing**ï¼šä½¿ç”¨æ©™è‰² + CSS Spinner åŠ¨ç”»ï¼Œæä¾›å³æ—¶åé¦ˆï¼Œå‘ŠçŸ¥ç³»ç»Ÿæ­£åœ¨å·¥ä½œä¸­ã€‚
- **Ready**ï¼šä½¿ç”¨ç»¿è‰² + Check å›¾æ ‡ï¼Œæ˜ç¡®å‘ŠçŸ¥èµ„æºå¯ç”¨ã€‚
- **A11y**ï¼šæ·»åŠ  `aria-label` å’Œ `title` å±æ€§ï¼Œä¿è¯æ— éšœç¢è®¿é—®ä½“éªŒã€‚

### 3. æ•°æ®æŒä¹…åŒ–ä¸å•ä¾‹æ¨¡å¼é‡æ„ (Global State Refactor)
*è§£å†³ç—›ç‚¹ï¼šé¡µé¢åˆ‡æ¢å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œå¤šé¡µé¢æ•°æ®ä¸åŒæ­¥ã€‚*

ä¸ºäº†æ‰“é€š Knowledge å’Œ Chatï¼Œæˆ‘é‡æ„äº† `useKnowledge` Composableï¼š
- **å•ä¾‹æ¨¡å¼**ï¼šå°† `list` çŠ¶æ€æå‡è‡³å‡½æ•°å¤–éƒ¨ã€‚æ— è®ºåœ¨å“ªä¸ªé¡µé¢è°ƒç”¨ `useKnowledge()`ï¼Œæ“ä½œçš„éƒ½æ˜¯åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œå®ç°äº†ç®€å•çš„å…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆæ›¿ä»£äº†å¼•å…¥ Pinia çš„å¤æ‚åº¦ï¼‰ã€‚
- **æŒä¹…åŒ– (Persistence)**ï¼š
    - åˆ©ç”¨ `watch(list, ..., { deep: true })` ç›‘å¬çŠ¶æ€å˜åŒ–ã€‚
    - ä½¿ç”¨ `localStorage` è¿›è¡Œæœ¬åœ°å­˜å‚¨ï¼Œç»“åˆåˆå§‹åŒ–è¯»å–é€»è¾‘ï¼Œä¿è¯åˆ·æ–°æµè§ˆå™¨æ•°æ®ä¸ä¸¢å¤±ã€‚
    - **é¢è¯•æ€è€ƒç‚¹**ï¼šè€ƒè™‘åˆ°æœªæ¥æ‰©å±•æ€§ï¼Œè‹¥æ•°æ®é‡å¢å¤§ï¼ˆ>5MBï¼‰ï¼Œå¯å¹³æ»‘è¿ç§»è‡³ IndexedDBã€‚

### 4. è·¯ç”±é©±åŠ¨çš„ä¸šåŠ¡é—­ç¯ (Deep Linking)
*è§£å†³ç—›ç‚¹ï¼šä¸Šä¼ åæ— æ³•ç«‹å³ä½¿ç”¨ã€‚*

å®ç°äº†ä» Knowledge åˆ° Chat çš„ä¸€é”®è·³è½¬ï¼š
- **è·³è½¬é€»è¾‘**ï¼š`router.push({ path: '/chat', query: { knowledge: id } })`ã€‚
- **å‚æ•°æ¥æ”¶**ï¼šåœ¨ Chat é¡µé¢ `onMounted` é˜¶æ®µè§£æ URL Queryï¼Œè‡ªåŠ¨åœ¨å·¦ä¾§çŸ¥è¯†åº“åˆ—è¡¨ä¸­**é¢„é€‰ (Pre-select)** ç›®æ ‡ IDã€‚
- **æ„ä¹‰**ï¼šè¿™ä¸ä»…æ˜¯ä¸€ä¸ªè·³è½¬ï¼Œè€Œæ˜¯é€šè¿‡ URL çŠ¶æ€åŒ–ï¼ˆDeep Linkingï¼‰ï¼Œå°†"çŸ¥è¯†ç”Ÿäº§"å’Œ"æ¶ˆè´¹"ä¸¤ä¸ªç¯èŠ‚ç´§å¯†ä¸²è”ï¼Œæå¤§æå‡äº†è°ƒè¯• RAG æ•ˆæœçš„æ•ˆç‡ã€‚

---

## ğŸ“¸ æ•ˆæœæ¼”ç¤º

*(æ­¤å¤„å¯è´´ä¸€å¼  GIFï¼šç‚¹å‡»æ–°å¢ -> æ˜¾ç¤º Processing -> å˜ä¸º Ready -> ç‚¹å‡»"åœ¨ Chat ä¸­ä½¿ç”¨" -> è·³è½¬å¹¶è‡ªåŠ¨é€‰ä¸­çš„å…¨è¿‡ç¨‹)*

## ğŸ“ ä»£ç å¤ç›˜ (Refactor Note)

```typescript
// src/pages/knowledge/composables/useKnowledge.ts

// 1. çŠ¶æ€æå‡è‡³æ¨¡å—ä½œç”¨åŸŸï¼ˆå•ä¾‹ï¼‰
const list = ref<KnowledgeItem[]>(JSON.parse(localStorage.getItem(KEY) || '[]'))

// 2. è‡ªåŠ¨æŒä¹…åŒ–
watch(list, (val) => localStorage.setItem(KEY, JSON.stringify(val)), { deep: true })

export function useKnowledge() {
  // ...ä¸šåŠ¡é€»è¾‘ï¼ˆAdd, Remove, Processï¼‰
  // UI ç»„ä»¶æ— éœ€å…³å¿ƒæ•°æ®å­˜å“ªé‡Œï¼Œåªç®¡è°ƒç”¨æ–¹æ³•
  return { list, addKnowledge, ... }
}
```
## ğŸ¤” æ€»ç»“ä¸å±•æœ›
ä»Šå¤©çš„ä¼˜åŒ–è®©è¿™ä¸ªå·¥ä½œå°ä»ä¸€ä¸ª"é™æ€ Demo"å˜æˆäº†ä¸€ä¸ª"å¯ç”¨çš„å·¥å…·"ã€‚
